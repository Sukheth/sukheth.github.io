<!DOCTYPE html>
<html lang="en">
  <script>
    // Apply theme immediately to prevent flash
    (function() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        document.documentElement.setAttribute('data-theme', savedTheme);
      } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.setAttribute('data-theme', 'dark');
      } else {
        document.documentElement.setAttribute('data-theme', 'light');
      }
    })();
  </script>
  {% include head.html %}
  <body>
    <nav>
      <div>{% include nav.html %}</div>
      <div style="display: flex; align-items: center; gap: 1rem;">
        <a class="internal-link" href="{{ site.baseurl }}/about">About</a>
        <button id="theme-toggle" aria-label="Toggle dark mode" style="padding: 0.4em 0.8em; border: none; border-radius: 50%; cursor: pointer; background: transparent; font-size: 1.2em;">
          <span id="theme-icon">◐</span>
        </button>
      </div>
    </nav>
    <div class="wrapper">
      <main>{{ content }}</main>
      <footer>{% include footer.html %}</footer>
    </div>

    <script>
      const themeToggle = document.getElementById('theme-toggle');
      const themeIcon = document.getElementById('theme-icon');
      const html = document.documentElement;

      // Check for saved theme preference or default to system
      const currentTheme = localStorage.getItem('theme') ||
        (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');

      if (currentTheme === 'dark') {
        html.setAttribute('data-theme', 'dark');
        themeIcon.textContent = '◐';
      }

      themeToggle.addEventListener('click', () => {
        const isDark = html.getAttribute('data-theme') === 'dark';
        const newTheme = isDark ? 'light' : 'dark';

        html.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        themeIcon.textContent = '◐';
      });
    </script>

    {% include link-previews.html wrapperQuerySelector="content" %}
  </body>
</html>
